<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>发布学生成绩</title>
    <link rel="stylesheet" href="../../layui/css/layui.css" media="all">
    <script src="../../JS/jquery.min.js" ></script>
    <script src="../../layui/layui.js"></script>
    <script src="../../layui/layui.all.js"></script>
</head>
<body>
<form class="layui-form" id="updateScoreForm">
    <div class="layui-form-item">
        <label class="layui-form-label">课程代码</label>
        <div class="layui-input-inline">
            <input type="text" name="course_code" id="course_code" required lay-verify="required" readonly=""  placeholder="不可编辑"  autocomplete="open"
                   class="layui-input">
        </div>

    </div>
    <div class="layui-form-item" >
        <label class="layui-form-label">课程名</label>
        <div class="layui-input-inline">
            <input type="text" name="course_name" id="course_name" required lay-verify="required" readonly=""  placeholder="不可编辑" autocomplete="open"
                   class="layui-input">
        </div>

    </div>

    <div class="layui-form-item" >
        <label class="layui-form-label">学生学号</label>
        <div class="layui-input-inline">
            <input type="text" name="stu_id"  id="stu_id" required lay-verify="required" readonly="" placeholder="不可编辑"  autocomplete="open"
                   class="layui-input">
        </div>

    </div>

    <div class="layui-form-item" >
        <label class="layui-form-label">学生姓名</label>
        <div class="layui-input-inline">
            <input type="text" name="stu_name"  id="stu_name" required lay-verify="required" readonly="" placeholder="不可编辑"  autocomplete="open"
                   class="layui-input">
        </div>

    </div>

    <div class="layui-form-item" >
        <label class="layui-form-label">成绩</label>
        <div class="layui-input-inline">
            <input type="text" name="score"  id="score" required lay-verify="required" placeholder="请输入学生成绩"  autocomplete="open"
                   class="layui-input">
        </div>

    </div>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn updateScore" lay-submit lay-filter="updateScore">立即提交</button>
        </div>
    </div>

</form>

<script>
    layui.use('form', function() {
        var form = layui.form;
        var layer = layui.layer;

        $(document).ready(function(){

            $(function () {
                //从父层获取值，json是父层的全局js变量。eval是将该string类型的json串变为标准的json串
                var parent_json = eval('('+parent.json+')');
                console.log(parent_json);
                var course_code = parent_json.course_code;
                var course_name = parent_json.course_name;
                var stu_id = parent_json.stu_id;
                var stu_name = parent_json.stu_name;
                var score = parent_json.score;

                $('#course_code').val(course_code);
                $('#course_name').val(course_name);
                $('#stu_id').val(stu_id);
                $('#stu_name').val(stu_name);
                $('#score').val(score);
            });

            $('.updateScore').click(function(){
                var course_code = $('#course_code').val();
                var stu_id = $('#stu_id').val();
                var score = $('#score').val();
                if (score < 100 && score > 0) {
                    $.ajax({
                        type: "post",
                        url: "/up_score",
                        data: {
                            'course_code': course_code,
                            'stu_id': stu_id,
                            'score': score
                        },
                        dataType: "json",
                        success: function (data) {
                            if (data.code > 200) {
                                layer.msg(data.message);
                                parent.layer.close();//关闭当前弹窗
                                window.parent.location.reload();//父页面刷新
                            }
                            else {
                                layer.msg(data.message);
                            }
                        },
                        error: function (arg1) {
                            layer.msg("系统错误");
                            console.log(arg1);
                            window.location.href = "../../index.html";
                        }
                    });
                    return false;
                }
                else {
                    alert("请填写正确的成绩！！！");
                }
            });

        });

    });
</script>

</body>
</html>